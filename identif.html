<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="iden.css">
    <title>IDENTIFICAR</title>
</head>
<body>
  <br>
  <h1>Identificación de plantas</h1>
  <br>
  <br>
  <br>
  <br>

    <form>
        <input type="file" multiple accept="image/png, image/jpeg"/>
        
        <button type="button" class="btn btn-outline-success">OK</button>
     
      </form>

      
       
       
<!---
      <button id="start-camera" onclick="clicked()">Com</button>
      <video id="video" width="320" height="240" autoplay></video>
      <button id="click-photo">Click Photo</button>
      <canvas id="canvas" width="320" height="240"></canvas>

      <button type="button" class="btn btn-outline-success">Success</button>
-->
    <script type="text/javascript">

//How to know if the buttón is clicked



  
   document.querySelector('button').onclick = function sendIdentification() {

   alert("Cargando");

const files = [...document.querySelector('input[type=file]').files];
const promises = files.map((file) => {
  return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = (event) => {
        const res = event.target.result;
        console.log(res);
        resolve(res);
      }
      reader.readAsDataURL(file)
  })
})


Promise.all(promises).then((base64files) => {
  console.log(base64files)
        
  const data = {

api_key: "8faTQmceb56ogYB4C0ouTMJTphZpdMMsqN7Jgo9hXmRfJ0xleX",
images: base64files,
// modifiers docs: https://github.com/flowerchecker/Plant-id-API/wiki/Modifiers
modifiers: ["crops_fast", "similar_images"],
language: "es",
// disease details docs: https://github.com/flowerchecker/Plant-id-API/wiki/Disease-details
disease_details: ["cause",
                "common_names",
                "classification",
                "description",
                "treatment",
                "url"],

                
    api_key: "cNpMRUOuheqtSau3yUvzUMmkL0ApX4q9w8bZfBqfZqhQ8FmRKY",
    images: base64files,
    // modifiers docs: https://github.com/flowerchecker/Plant-id-API/wiki/Modifiers
    modifiers: ["crops_fast", "similar_images"],
    plant_language: "es",
    // plant details docs: https://github.com/flowerchecker/Plant-id-API/wiki/Plant-details
    plant_details: ["common_names",
                    "url",
                    "name_authority",
                    "wiki_description",
                    "taxonomy",
                    "synonyms"],
  };

  const dato = {
    api_key: "cNpMRUOuheqtSau3yUvzUMmkL0ApX4q9w8bZfBqfZqhQ8FmRKY",
    images: base64files,
    // modifiers docs: https://github.com/flowerchecker/Plant-id-API/wiki/Modifiers
    modifiers: ["crops_fast", "similar_images"],
    language: "es",
    // disease details docs: https://github.com/flowerchecker/Plant-id-API/wiki/Disease-details
    disease_details: ["cause",
                    "common_names",
                    "classification",
                    "description",
                    "treatment",
                    "url"],
  };

  fetch('https://api.plant.id/v2/health_assessment', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(dato),
  })
  .then(response => response.json())
  .then(dato => {
  
    console.log('Success:', dato);
    n1= dato.health_assessment.is_healthy;
   n2= dato.health_assessment.diseases[0].name;
   n3=dato.health_assessment.diseases[0].disease_details.description;
   n4= dato.health_assessment.diseases[1].name;
   n5=dato.health_assessment.diseases[1].disease_details.description;
 if (n1==true){
    n1="Sí";
    n2="NA";
    n3="NA";
    n4="NA";
    n5="NA";
    
  }else{
    n1="No";
  }

  document.write('<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">');
   document.write(" <link rel='stylesheet' href='iden.css'>");
    document.write("<table class='customTable'>");
document.write("<tr><td>¿Está sano?</td><td>Nombre de la enfermedad</td><td>Descripción de la enfermedad</td></tr>");
document.write("<tr><td>"+n1+"</td><td>"+n2+"</td><td>"+n3+"</td></tr>");

document.write("<tr><td>"+n1+"</td><td>"+n4+"</td><td>"+n5+"</td></tr>");
document.write("</table>");

  })
  .catch((error) => {
    console.error('Error:', error);
  });
  
  fetch('https://api.plant.id/v2/identify', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(data),
  })
  .then(response => response.json())
  .then(data => {
    console.log('Success:', data);

    n1=data.suggestions[0].plant_name;
    n2= data.suggestions[0].plant_details.wiki_description.value;
    n3= data.suggestions[0].plant_details.taxonomy.class;
    n4= data.suggestions[0].plant_details.synonyms;
    n5=data.is_plant_probability;

if (n5>0.7){

  
  n5="Es una planta";
  alert(""+n5);

}else{
  
  n5="No es una planta";
  alert(""+n5);
  n1="NA";
  n2="NA";
  n3="NA";
  n4="NA";
  location = "identif.html";

}
document.write("<table class='customTable'>");

  document.write("<tr>");
document.write("<td>Nombre</td>");
document.write("<td>Descripción</td>");
document.write("<td>Taxonomia</td>");
document.write("<td>Sinonimos</td>");
document.write("</tr>");
document.write("<tr><td>"+n1+"</td><td>"+n2+"</td><td>"+n3+"</td><<td>"+n4+"</td></tr> ");
document.write("</table>");
document.write('<br>')
document.write('<br>')
document.write('<br>')
document.write('<br>')

document.write('<button type="button"  class="btn btn-outline-success" onclick=window.location.href="https://gabrielesparza.000webhostapp.com/ecobot1/ecobot.html";>¿Desea saber más?</button>');

document.write('<button type="button"  class="btn btn-outline-success" onclick=window.location.href="https://gabrielesparza.000webhostapp.com/ecobot1/identif.html";>Regresar</button>');
  })
  .catch((error) => {
    console.error('Error:', error);
  });
})

};


      //function

/*
      let camera_button = document.querySelector("#start-camera");
let video = document.querySelector("#video");
let click_button = document.querySelector("#click-photo");
let canvas = document.querySelector("#canvas");

camera_button.addEventListener('click', async function() {
   	let stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
	video.srcObject = stream;
});

click_button.addEventListener('click', function() {
   	canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
   	let image_data_url = canvas.toDataURL('image/jpeg');

   	// data url of the image
   	console.log(image_data_url);

       
                
          const data = {



            api_key: "uENFaKDhtp3sR4bIeQucFEQNO4uOoxSaARHLd5jGyrMA4veHEC",
            images: [image_data_url],
            // modifiers docs: https://github.com/flowerchecker/Plant-id-API/wiki/Modifiers
            modifiers: ["crops_fast", "similar_images"],
            plant_language: "es",
            // plant details docs: https://github.com/flowerchecker/Plant-id-API/wiki/Plant-details
            plant_details: ["common_names",
                            "url",
                            "name_authority",
                            "wiki_description",
                            "taxonomy",
                            "synonyms"],
          };
          

          
          const dato = {
            api_key: "AjloWiXuIPHWjFJMfsuBqz5KaSMnRTkuX60EWM6gPsBsu6wCQn",
            images: [image_data_url],
            // modifiers docs: https://github.com/flowerchecker/Plant-id-API/wiki/Modifiers
            modifiers: ["crops_fast", "similar_images"],
            language: "en",
            // disease details docs: https://github.com/flowerchecker/Plant-id-API/wiki/Disease-details
            disease_details: ["cause",
                            "common_names",
                            "classification",
                            "description",
                            "treatment",
                            "url"],
          };

          fetch('https://api.plant.id/v2/health_assessment', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(dato),
          })
          .then(response => response.json())
          .then(dato => {
            console.log('Success:', dato);
            n1= dato.health_assessment.is_healthy;
           n2= dato.health_assessment.diseases[0].name;
           n3=dato.health_assessment.diseases[0].disease_details.description;
           n4= dato.health_assessment.diseases[1].name;
           n5=dato.health_assessment.diseases[1].disease_details.description;
    document.write(" <a class='btn btn-primary' data-bs-toggle='collapse' href='#collapseExample' role='button' aria-expanded='false' aria-controls='collapseExample'>Link with href</a>");
            document.write("<table border=1>");
    document.write("<tr><td>¿Está sano?</td><td>Nombre de la enfermedad</td><td>Descripción de la enfermedad</td></tr>");
    document.write("<tr><td>"+n1+"</td><td>"+n2+"</td><td>"+n3+"</td></tr>");
    
    document.write("<tr><td>"+n1+"</td><td>"+n4+"</td><td>"+n5+"</td></tr>");
    document.write("</table>");
          })
          .catch((error) => {
            console.error('Error:', error);
          });

          fetch('https://api.plant.id/v2/identify', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
          })
          .then(response => response.json())
          .then(data => {
            console.log('Success:', data);
           // document.write("Hello World", " ", data.suggestions[0].plant_details.common_names, " ", data.suggestions[0].plant_details.url, " ", data.suggestions[0].plant_details.name_authority, " ", data.suggestions[0].plant_details.wiki_description, " ", data.suggestions[0].plant_details.taxonomy, " ", data.suggestions[0].plant_details.synonyms);

            document.write(data.suggestions[0].similar_images[0].url);
            document.write("<img src=" + data.suggestions[0].similar_images[0].url + " alt=" + data.suggestions[0].similar_images[0].url + " srcset=" + data.suggestions[0].similar_images[0].url + ">");
            document.write(data.suggestions[0].plant_name);
            
          })
          .catch((error) => {
            console.error('Error:', error);
          });
        


});*/


    
    
    </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

</body>
</html>
